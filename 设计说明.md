# Module3 流程与业务逻辑
#设计说明
**成员：** 杨昊 张远驰 何宇轩
[toc]
**** 

## 程序模块设计
### 登录模块
&emsp;&emsp;登录模块由其他小组负责，在登录完成后打开与后端交互的Session，并使用唯一ID对用户进行标识。
&emsp;&emsp;此模块的设计是整个系统中至关重要的一部分。一旦用户成功登录，系统需要确保其身份得到正确验证并且能够与后端进行有效的交互。登录模块由专门的小组负责，他们的任务包括实现安全可靠的用户认证机制以及建立与后端服务器的通信通道。
&emsp;&emsp;在用户成功通过身份验证后，登录模块负责打开一个与后端交互的Session。这个Session将被用来在用户和服务器之间传递数据，并确保通信的安全性和完整性。此外，为了更好地管理用户会话，登录模块会为每个用户分配一个唯一的ID，这个ID将在整个会话期间用于标识和跟踪用户的操作。
&emsp;&emsp;登录模块的任务还包括管理用户的登录状态，例如处理用户的注销请求、管理会话过期时间等。通过有效的登录模块设计，整个系统能够保障用户信息的安全性，确保只有经过授权的用户才能够访问系统资源，从而提升系统的整体安全性和稳定性。
### BPMN绘制模块
&emsp;&emsp;**功能1**：为用户提供web页面绘制业务流程图，生成BPMN文件，将结果保存至本地。
&emsp;&emsp;该功能使用户能够通过系统的web页面绘制业务流程图，通过直观的图形界面轻松设计复杂的流程结构。用户可以在页面上拖拽各种BPMN元素，连接它们，并定义流程中的各个步骤和决策点。完成后，系统将生成对应的BPMN文件，用户可以选择将结果保存至本地，以便日后的查看、修改或分享。这种直观的可视化设计不仅降低了业务人员理解和参与业务流程建模的门槛，同时也有助于减少错误，提高工作效率。生成的BPMN文件可以轻松地与Activiti引擎等BPMN支持的系统进行集成，实现无缝的流程执行。
&emsp;&emsp;**功能2**：为用户提供流程图模板，辅助用户基于模板进行流程定义
&emsp;&emsp;除了自由绘制，系统还为用户提供了一系列流程图模板，包括一些通用的业务流程模型，以及特定行业或业务场景的模板。用户可以基于这些模板进行流程定义，从而加速流程设计的过程。这种模板化的设计方法有助于规范化业务流程的建模，提高流程的一致性，并降低业务分析人员的学习成本。
（BPMN 即 Business Process Model and Notation，是一种用于描述业务流程的图形标记语言，可以用来建模和文档化数据流程，通常用于业务流程管理和工作流程建模。Activiti 引擎提供了对 BPMN 良好支持，可以对其进行储存、解析等操作。）

### BPMN解析模块
&emsp;&emsp;**功能1**：解析BPMN中的必填字段，返回字段列表。
BPMN（Business Process Model and Notation）解析模块的第一个重要功能是对BPMN文件进行解析，识别其中的必填字段，并将它们以清晰的列表形式返回。必填字段的准确解析对于后续流程执行和管理至关重要，因为它确保了流程定义的完整性和正确性。通过该功能，系统能够提供用户友好的界面，展示解析后的字段，使用户能够轻松理解和验证流程定义。
&emsp;&emsp;**功能2**：任务执行过程中动态解析。
BPMN解析模块的第二个关键功能是在任务执行过程中实现动态解析。这意味着系统可以根据任务的实际执行情况，动态地解析和处理相关字段。这种灵活性使得系统能够适应不同的运行时情境，确保流程在执行过程中能够灵活应对变化。例如，当某个任务的输入参数发生变化时，系统可以动态调整解析策略，确保任务能够顺利执行。

### 流程部署模块
&emsp;&emsp;**功能1**：用户在 web 页面中选择 BPMN 文件，进行流程部署。
&emsp;&emsp;在流程管理系统中，流程部署模块的首要功能是为用户提供便捷的流程部署操作。通过系统的 web 页面，用户可以轻松地选择并上传BPMN文件，触发流程部署流程。这一功能的实现使得业务人员和流程管理员能够在无需深入技术细节的情况下，快速将业务流程引入系统中。

  流程部署是 activiti 启动的第一步，其重要性在于将业务流程转化为可执行的流程定义。在选择BPMN文件后，系统将解析该文件，提取流程定义、节点信息等关键数据，并将这些数据存储到数据库中。这样一来，系统就能够随时调取这些信息，确保在执行过程中能够准确地按照业务规则和流程逻辑进行操作。

  部署完的流程将被存储至数据库中，保存文件内容、流程定义相关的信息。这个步骤不仅为后续的流程执行提供了必要的基础数据，也确保了流程的可追溯性和管理性。通过数据库的存储，系统可以高效地检索、更新和管理各个流程的定义，使得流程部署模块成为流程管理系统中的关键组成部分。

流程部署模块的这两个功能共同为企业提供了简便而强大的流程引入和管理工具。用户可以通过直观的 web 界面完成流程部署，而系统则通过存储相关信息，为后续的流程执行奠定坚实的基础。这有助于提高业务的灵活性，降低引入新业务流程的门槛，从而推动整个企业的数字化转型。
### 启动实例模块
&emsp;&emsp;**功能1**：根据权限，向用户展示其可以访问的已部署流程。
启动实例模块的首要功能是基于用户权限向其展示可以访问的已部署流程。通过仔细管理和配置用户权限，系统能够确保用户只能看到其具备访问权限的流程列表。这种精确的权限控制不仅有助于信息安全，同时也简化了用户界面，使用户能够更迅速地找到并选择要发起的业务流程。

&emsp;&emsp;**功能2**：用户选择需要发起的流程，在弹窗中输入需要指定的属性，启动流程实例。
一旦用户在已部署流程列表中选择了目标流程，系统将为其提供一个便捷的弹窗界面，用于输入启动流程实例时需要指定的属性。这些属性可能包括任务执行人、截止日期、附加信息等。用户通过输入这些信息，可以根据具体的业务需求对流程进行个性化配置，以适应不同的场景和要求。

在用户输入完所需属性后，系统将启动流程实例。这一过程涉及了将流程定义转化为可执行实例的关键步骤。系统根据用户提供的信息，动态地生成并启动一个新的流程实例，使得流程能够按照预定的规则和逻辑在系统中运行。这种用户驱动的流程启动方式使得业务人员能够直接参与到流程管理中，提高了业务灵活性和响应速度。
### 任务操作模块
&emsp;&emsp;**功能1**：用户完成分配给其的某项任务。
任务操作模块的首要功能是让用户能够轻松完成其被分配的任务。通过清晰的界面和直观的操作流程，用户可以迅速了解任务的内容、要求以及可能的操作选项。完成任务的过程中，系统记录用户的操作，并确保任务的状态得到及时更新，以便后续流程的顺利进行。


&emsp;&emsp;**功能2**：为用户提供链接，查看与任务相关的信息。

为了提供更全面的任务信息，任务操作模块还为用户提供了链接，使其能够查看与任务相关的详细信息。这可能包括任务的历史记录、相关文档、流程图等。通过这些链接，用户能够深入了解任务的上下文，从而更好地理解任务的意义和目标。这种信息的透明性有助于用户更加全面地参与到任务的执行过程中，提高工作效率和任务执行的准确性。

### 历史记录模块
&emsp;&emsp;**功能1**：向用户展示正在分派给他，或曾经分派给他的任务。
历史记录模块的首要功能是为用户提供对已分派任务的全面视图。通过展示当前分派给用户的任务以及他曾经完成的任务，用户能够迅速查看自己的工作历史。这包括了当前进行中的任务，以及已经完成或取消的任务。这一功能有助于用户追踪工作进展，查找任务的上下文，并提供对过去工作的回顾。

&emsp;&emsp;**功能2**：历史记录过滤。
为了更好地管理和查找历史任务记录，历史记录模块提供了强大的过滤功能。用户可以根据不同的条件来过滤历史任务，如任务状态（已完成、进行中、已取消等）、时间范围、任务类型等。这种过滤机制使得用户能够快速定位到感兴趣的历史任务，从而更加高效地进行信息检索和分析。

通过历史记录模块，用户可以回顾自己的工作历程，了解任务的执行情况，同时系统也能够为用户提供更加智能的工作辅助。例如，系统可以根据历史记录生成工作报告、分析用户工作效率，以及提供个性化的推荐和建议。这进一步提高了用户对工作历史的理解和对未来工作的规划。

### 流程监控模块

## 整体架构
&emsp;&emsp;流程与业务逻辑模块基于 Activiti 逻辑引擎进行构建，并使用 Spring 框架整合。Activiti 是一个开源的业务流程管理（BPM）和工作流引擎，用于执行和自动化基于 BPMN 模型的业务流程。


### 登录
&emsp;&emsp;本模块使用该模块的用户都完成了登录，后端已经建立了 Session。登录模块由其他小组负责，我们需要的功能是在登录完成后打开与后端交互的 Session，并使用唯一ID对用户进行标识，将 ID 保存在会话中。本模块设计了类似的替代登录界面供调试使用，但没有对用户的身份信息做任何核验，知识单纯地获取了用户 ID。
### BPMN绘制
&emsp;&emsp;BPMN 绘制的页面有许多现成软件可以参考，且绘制 BPMN 图并非本项目重点。本项目提供前端配置BPMN的页面，使用户能基于我们的规则生成BPMN文件，并给用户提供页面以部署BPMN。
### 用户组分配
&emsp;&emsp;许多时候，某个任务可以同时被很多人看到，但只能有一个人进行处理。本模块提供用户组定义的接口，同时流程进行时也支持以组为单位的任务分配以及单角色任务认领。
&emsp;&emsp;
### BPMN解析
&emsp;&emsp;BPMN解析模块负责解析已部署流程中的未知属性，并区分他们在什么阶段是必填的。本模块支持动态填写流程中的属性，在流程实例化时部分属性为必填属性，需要在实例化之前完成填写，其余待填属性则须在任务流到达的时候填写。
### 部署流程
&emsp;&emsp;为用户提供界面上传绘制完成的BPMN图与流程图对应的图像文件。

### 启动流程实例
&emsp;&emsp;启动流程实例需要填写流程中的必填属性，在启动流程时解析BPMN得到必填属性列表，返还给用户进行填写，用户填写完成后依据填写的属性数据生成流程实例。

### 操作任务
&emsp;&emsp;
某一任务在完成时需要考虑与之相邻的属性

### 历史记录查询
&emsp;&emsp;

## 环境配置
### 开发环境
Project SDK: corretto-17
数据库: MySQL 8.1.0
### 本地调试配置
#### 数据库配置
&emsp;&emsp;安装MySQL，配置密码。
&emsp;&emsp;新建一个数据库activiti，并添加一个名为activiti的schema（如果不是这个名字需要修改配置文件数据库连接url）。
分别在activiti.cfg.xml文件和application.yml文件中修改密码（和用户名）。
#### 依赖配置
&emsp;&emsp;如果MySQL为8.1.0版本，跳过该步骤。
&emsp;&emsp;若不是8.1.0，前往https://mvnrepository.com/ 搜索mysql找到数据库版本对应的driver jar包依赖，替换pom.xml文件中的dependency（mysql-connector-j）。替换完成后maven重新加载项目。
#### 启动流程
&emsp;&emsp;首先，运行Test/java中的启动TestCreate，若activiti schema中新建了28张表，说明之前的配置正确。
&emsp;&emsp;(可选)接着，分别运行Test/java/TestDeployment中的testDeploymentSingle，以及Test/javaTestStartProcess中的startProcess，部署一个流程并启动该流程。该流程参与者有alex和Jack，第一个任务将被分配给alex。
&emsp;&emsp;然后，运行main/java/WorkFlowApplication，启动后端。
&emsp;&emsp;启动完成后访问127.0.0.1/login,用户名输入alex或Jack并登录即可进行流程操作。

## 前端代码
### 页面
### js
## 后端代码


## 模块使用说明
### 运行任务流程
### 模块间集成接口

## API List
### 实体类
**MyTaskEntity**
|Type| Key|
|:----:|:----:|
|String| Id|
|String| name|
|String| owner|
|String| assignee|
|String| description|
|Date  |  createTime|
|Date  |  dueDate|

**MyDeploymentEntity**
|Type| Key|
|:----:|:----:|
|String |Id|
|String |name|
|String |description|
|Boolean| suspended|

**MyTaskHistoryEntity**
|Type| Key|
|:----:|:----:|
|String| Id|
|Date  | startTime|
|Date  | endTime|
|String| assignee|
|String| activityName |

**MyTaskEntity**
|Type| Key|
|:----:|:----:|

### 部署





| URL      | 功能     | 调用方法     | 传参方式     | 传入参数  | 返回值 |
| ----------- | ----------- | ----------- | ----------- | ----------- | ----------- |
|/deployment /getAll     | 获取所有部署     | get     | /     | /  | MyTaskEntity |
| /deployment/createInstance     | 启动流程  | get     | /     | /  | / |
| 。。。 |

# 分工与日志
## 分工情况
**杨昊**


**何宇轩**

**张远驰**


## 进度日志
### 迭代1
